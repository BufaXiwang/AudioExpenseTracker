# AIåˆ†æåŠ è½½è¿‡ç¨‹ä¼˜åŒ–

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

1. **ä¿®å¤è¯­éŸ³è¯†åˆ«é”™è¯¯**: è§£å†³ Code=1110 "No speech detected" è¯¯æŠ¥é—®é¢˜
2. **å¢å¼ºç”¨æˆ·ä½“éªŒ**: ä¸ºAIåˆ†æè¿‡ç¨‹æ·»åŠ è¯¦ç»†çš„åŠ è½½çŠ¶æ€å’Œè¿›åº¦æŒ‡ç¤º
3. **æä¾›è§†è§‰åé¦ˆ**: è®©ç”¨æˆ·æ¸…æ¥šäº†è§£å½“å‰å¤„ç†è¿›åº¦

## ğŸ› é—®é¢˜ä¿®å¤

### è¯­éŸ³è¯†åˆ«é”™è¯¯å¤„ç†
**é—®é¢˜**: å‡ºç° `Error Domain=kAFAssistantErrorDomain Code=1110 "No speech detected"` é”™è¯¯

**åŸå› åˆ†æ**:
- Code=1110 æ˜¯è¯­éŸ³è¯†åˆ«ç³»ç»Ÿçš„æ­£å¸¸è¡Œä¸º
- å½“ç”¨æˆ·åœæ­¢è¯´è¯åï¼Œç³»ç»Ÿç»§ç»­ç›‘å¬ä¸€æ®µæ—¶é—´
- å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°æ–°çš„è¯­éŸ³è¾“å…¥ï¼Œä¼šæŠ›å‡ºæ­¤é”™è¯¯
- è¿™ä¸å½±å“å·²è¯†åˆ«çš„æ–‡æœ¬å†…å®¹

**è§£å†³æ–¹æ¡ˆ**:
```swift
if nsError.domain == "kAFAssistantErrorDomain" && (nsError.code == 1101 || nsError.code == 1110) {
    // 1101: ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œå¯ä»¥å¿½ç•¥
    // 1110: "No speech detected" - å½•éŸ³ç»“æŸåçš„æ­£å¸¸ç°è±¡
    print("å¿½ç•¥ç³»ç»Ÿè¯­éŸ³è¯†åˆ«é”™è¯¯ (Code: \(nsError.code)): \(error.localizedDescription)")
    return
}
```

## ğŸ¨ AIåˆ†æåŠ è½½ä¼˜åŒ–

### 1. å¢å¼ºçŠ¶æ€ç®¡ç†
**åŸæœ‰çŠ¶æ€**: ç®€å•çš„ `.analyzing` çŠ¶æ€
**ä¼˜åŒ–å**: å¸¦è¿›åº¦ä¿¡æ¯çš„ `.analyzing(progress: String)` çŠ¶æ€

```swift
enum RecordingStep: Equatable {
    case analyzing(progress: String)  // æ–°å¢è¿›åº¦å‚æ•°
    
    var isAnalyzing: Bool {
        if case .analyzing = self {
            return true
        }
        return false
    }
}
```

### 2. åˆ†æ­¥éª¤AIåˆ†ææµç¨‹
**ä¼˜åŒ–å‰**: ä¸€æ¬¡æ€§è°ƒç”¨AIæœåŠ¡ï¼Œç”¨æˆ·æ— æ³•æ„ŸçŸ¥è¿›åº¦
**ä¼˜åŒ–å**: åˆ†è§£ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œæä¾›å®æ—¶åé¦ˆ

```swift
func analyzeRecording() async {
    // æ­¥éª¤1: å‡†å¤‡åˆ†æ
    currentStep = .analyzing(progress: "å‡†å¤‡AIåˆ†æ...")
    try? await Task.sleep(nanoseconds: 300_000_000)
    
    // æ­¥éª¤2: è¿æ¥æœåŠ¡
    currentStep = .analyzing(progress: "è¿æ¥AIæœåŠ¡...")
    
    // æ­¥éª¤3: åˆ†æå†…å®¹
    currentStep = .analyzing(progress: "åˆ†æè¯­éŸ³å†…å®¹...")
    try? await Task.sleep(nanoseconds: 200_000_000)
    
    // æ­¥éª¤4: è¯†åˆ«è´¹ç”¨
    currentStep = .analyzing(progress: "è¯†åˆ«è´¹ç”¨ä¿¡æ¯...")
    let result = try await aiService.analyzeExpense(request)
    
    // æ­¥éª¤5: å¤„ç†ç»“æœ
    currentStep = .analyzing(progress: "å¤„ç†åˆ†æç»“æœ...")
    try? await Task.sleep(nanoseconds: 300_000_000)
    
    // æ­¥éª¤6: ç”Ÿæˆè®°å½•
    if result.isValid {
        currentStep = .analyzing(progress: "ç”Ÿæˆè´¹ç”¨è®°å½•...")
        try? await Task.sleep(nanoseconds: 200_000_000)
        await createPendingExpense(from: result)
    }
}
```

### 3. è§†è§‰æ•ˆæœå¢å¼º

#### AIåˆ†æè¿›åº¦è§†å›¾ (AIAnalysisProgressView)
- **åŠ¨ç”»è¿›åº¦æ¡**: 5ä¸ªæµåŠ¨çš„è¿›åº¦æ¡æ®µï¼Œè¥é€ å¤„ç†æ„Ÿ
- **è„‰å†²AIå›¾æ ‡**: brainå›¾æ ‡çš„ç¼©æ”¾åŠ¨ç”»
- **è£…é¥°å…ƒç´ **: sparkleså›¾æ ‡å¢åŠ ç§‘æŠ€æ„Ÿ

```swift
struct AIAnalysisProgressView: View {
    @State private var animationOffset: CGFloat = -200
    @State private var pulseScale: CGFloat = 1.0
    
    var body: some View {
        VStack(spacing: 12) {
            // æµåŠ¨è¿›åº¦æ¡
            HStack(spacing: 4) {
                ForEach(0..<5, id: \.self) { index in
                    RoundedRectangle(cornerRadius: 2)
                        .fill(Color.orange.opacity(0.3))
                        .overlay(æµåŠ¨æ•ˆæœ)
                        .animation(å»¶è¿ŸåŠ¨ç”»)
                }
            }
            
            // AIå›¾æ ‡å’Œæ–‡å­—
            HStack {
                è„‰å†²brainå›¾æ ‡
                Text("AIæ™ºèƒ½åˆ†æä¸­")
                sparklesè£…é¥°å›¾æ ‡
            }
        }
    }
}
```

#### çŠ¶æ€æŒ‡ç¤ºä¼˜åŒ–
- **å½•éŸ³çŠ¶æ€**: "å†æ¬¡ç‚¹å‡»åœæ­¢å½•éŸ³" / "æ¾å¼€æŒ‰é’®åœæ­¢å½•éŸ³"
- **å¤„ç†çŠ¶æ€**: "æ­£åœ¨å¤„ç†å½•éŸ³æ–‡ä»¶..."
- **åˆ†æçŠ¶æ€**: "AIæ­£åœ¨æ™ºèƒ½åˆ†æè´¹ç”¨ä¿¡æ¯"

## ğŸ¯ ç”¨æˆ·ä½“éªŒæå‡

### 1. æ¸…æ™°çš„è¿›åº¦åé¦ˆ
- **å®æ—¶çŠ¶æ€**: ç”¨æˆ·å¯ä»¥çœ‹åˆ°å½“å‰å¤„ç†åˆ°å“ªä¸ªæ­¥éª¤
- **é¢„æœŸç®¡ç†**: é€šè¿‡åˆ†æ­¥éª¤æ˜¾ç¤ºï¼Œç”¨æˆ·çŸ¥é“è¿˜éœ€è¦ç­‰å¾…å¤šä¹…
- **è§†è§‰å¸å¼•**: åŠ¨ç”»æ•ˆæœè®©ç­‰å¾…è¿‡ç¨‹ä¸æ¯ç‡¥

### 2. æ™ºèƒ½é”™è¯¯å¤„ç†
- **è¿‡æ»¤æ— å…³é”™è¯¯**: ä¸å†æ˜¾ç¤ºç³»ç»Ÿçº§çš„æ­£å¸¸é”™è¯¯
- **ä¿ç•™é‡è¦é”™è¯¯**: çœŸæ­£çš„é”™è¯¯ä»ä¼šæ­£ç¡®æ˜¾ç¤º
- **ç”¨æˆ·å‹å¥½**: å‡å°‘å›°æƒ‘å’Œè¯¯è§£

### 3. åˆ†å±‚ä¿¡æ¯å±•ç¤º
- **ä¸»è¦çŠ¶æ€**: å¤§æ ‡é¢˜æ˜¾ç¤ºå½“å‰æ­¥éª¤
- **è¾…åŠ©ä¿¡æ¯**: å°å­—è¯´æ˜å…·ä½“åœ¨åšä»€ä¹ˆ
- **è§†è§‰å…ƒç´ **: å›¾æ ‡å’ŒåŠ¨ç”»å¢å¼ºç†è§£

## ğŸ“Š æŠ€æœ¯å®ç°ç»†èŠ‚

### æ—¶é—´æ§åˆ¶
- **å‡†å¤‡é˜¶æ®µ**: 300ms - ç»™ç”¨æˆ·ååº”æ—¶é—´
- **è¿æ¥é˜¶æ®µ**: å³æ—¶ - å®é™…ç½‘ç»œè¯·æ±‚æ—¶é—´
- **åˆ†æé˜¶æ®µ**: 200ms - çŸ­æš‚åœé¡¿å¢åŠ çœŸå®æ„Ÿ
- **ç»“æœå¤„ç†**: 300ms - è®©ç”¨æˆ·æ„ŸçŸ¥åˆ°å¤„ç†è¿‡ç¨‹
- **è®°å½•ç”Ÿæˆ**: 200ms - æœ€åçš„å®Œæˆæ„Ÿ

### åŠ¨ç”»è®¾è®¡
- **è¿›åº¦æ¡**: 1.5ç§’å¾ªç¯ï¼Œ0.1ç§’å»¶è¿Ÿé”™å¼€
- **è„‰å†²æ•ˆæœ**: 1.0ç§’å¾ªç¯ï¼Œè‡ªåŠ¨åè½¬
- **é¢œè‰²ä¸»é¢˜**: æ©™è‰²ç³»ï¼Œä¸åˆ†æçŠ¶æ€ä¿æŒä¸€è‡´

### çŠ¶æ€åŒæ­¥
- **å®æ—¶æ›´æ–°**: æ‰€æœ‰UIç»„ä»¶éƒ½èƒ½æ„ŸçŸ¥çŠ¶æ€å˜åŒ–
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨æšä¸¾ç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„é‡ç»˜

## âœ… ä¼˜åŒ–æ•ˆæœ

### ç”¨æˆ·æ„ŸçŸ¥æ”¹å–„
- âœ… **é”™è¯¯å‡å°‘**: ä¸å†çœ‹åˆ°æ— å…³çš„ç³»ç»Ÿé”™è¯¯
- âœ… **è¿›åº¦æ¸…æ™°**: çŸ¥é“AIåˆ†æçš„å…·ä½“è¿›å±•
- âœ… **ç­‰å¾…ä½“éªŒ**: åŠ¨ç”»è®©ç­‰å¾…å˜å¾—æœ‰è¶£
- âœ… **ä¿¡å¿ƒæå‡**: è¯¦ç»†åé¦ˆå¢åŠ ç”¨æˆ·ä¿¡ä»»

### æŠ€æœ¯è´¨é‡æå‡
- âœ… **é”™è¯¯å¤„ç†**: æ›´æ™ºèƒ½çš„é”™è¯¯è¿‡æ»¤æœºåˆ¶
- âœ… **çŠ¶æ€ç®¡ç†**: æ›´ç»†ç²’åº¦çš„çŠ¶æ€æ§åˆ¶
- âœ… **ç”¨æˆ·ç•Œé¢**: æ›´ä¸°å¯Œçš„è§†è§‰åé¦ˆ
- âœ… **ä»£ç è´¨é‡**: æ›´æ¸…æ™°çš„é€»è¾‘ç»“æ„

## ğŸ”® æœªæ¥æ‰©å±•

### å¯èƒ½çš„æ”¹è¿›
1. **è‡ªé€‚åº”æ—¶é—´**: æ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´ç­‰å¾…æ—¶é—´
2. **è¿›åº¦ç™¾åˆ†æ¯”**: æ˜¾ç¤ºå…·ä½“çš„å®Œæˆç™¾åˆ†æ¯”
3. **å–æ¶ˆåŠŸèƒ½**: å…è®¸ç”¨æˆ·ä¸­æ–­AIåˆ†æ
4. **ç¼“å­˜ä¼˜åŒ–**: å¯¹ç›¸ä¼¼å†…å®¹ä½¿ç”¨ç¼“å­˜ç»“æœ

### æ€§èƒ½è€ƒè™‘
1. **å†…å­˜ä½¿ç”¨**: åŠ¨ç”»æ•ˆæœçš„å†…å­˜å ç”¨
2. **ç”µæ± æ¶ˆè€—**: æŒç»­åŠ¨ç”»å¯¹ç”µæ± çš„å½±å“
3. **ç½‘ç»œä¼˜åŒ–**: AIè¯·æ±‚çš„è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

## ğŸ“ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†è¯­éŸ³è¯†åˆ«çš„è¯¯æŠ¥é”™è¯¯ï¼Œå¹¶ä¸ºAIåˆ†æè¿‡ç¨‹æ·»åŠ äº†ä¸°å¯Œçš„ç”¨æˆ·åé¦ˆã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥æ¸…æ¥šåœ°äº†è§£ç³»ç»Ÿæ­£åœ¨åšä»€ä¹ˆï¼Œç­‰å¾…è¿‡ç¨‹å˜å¾—æ›´åŠ æ„‰å¿«å’Œå¯é¢„æœŸã€‚

è¿™äº›æ”¹è¿›ä¸ä»…æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œè¿˜ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚åˆ†æ­¥éª¤çš„çŠ¶æ€ç®¡ç†å’Œå¯æ‰©å±•çš„UIç»„ä»¶è®¾è®¡ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°æ·»åŠ æ›´å¤šçš„å¤„ç†æ­¥éª¤å’Œè§†è§‰æ•ˆæœã€‚ 